---

- name: Copy Kubernetes-Dashboard yml file
  template: src=kube-dash-rbac.yml.j2  dest={{ kube_addon_dir }}/k8s-dashboard.yml
  
- name: Copy Kubernetes-Dashboard crt file
  template: src=dashboard.crt.j2  dest={{ kube_addon_dir }}/certs/dashboard.crt

- name: Copy Kubernetes-Dashboard key file
  template: src=dashboard.key.j2  dest={{ kube_addon_dir }}/certs/dashboard.key

- name: Copy Kubernetes-Dashboard certs to kube_system
  command: kubectl --kubeconfig={{ kubeadmin_config }} create secret generic kubernetes-dashboard-certs --from-file={{ kube_addon_dir }}/certs -n kube-system

- name: Check Kubernetes-Dashboard role already exists
  command: kubectl --kubeconfig={{ kubeadmin_config }} get clusterrolebinding | grep kubernetes-dashboard
  delegate_to: "{{ groups['master'][0] }}"
  run_once: true
  register: check_role_dash
  ignore_errors: true
  
- name: Apply Kubernetes-Dashboard Deployment
  when: check_role_dash|failed
  command: kubectl apply --kubeconfig={{ kubeadmin_config }} -f {{ kube_addon_dir }}/k8s-dashboard.yml
  delegate_to: "{{ groups['master'][0] }}"
  run_once: true